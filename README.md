# Violence Detection System (PyTorch)

Система классификации видео для обнаружения насилия, реализованная на связке сверточной нейросети (CNN) и рекуррентных слоев (GRU). Данный подход позволил добиться более высокой стабильности предсказаний по сравнению с 3D-свертками на используемом наборе данных.

## Результаты

* **Архитектура:** EfficientNet-B0 (экстрактор признаков) + GRU (анализ временных последовательностей).
* **Точность на валидации:** ~98-99%.
* **Формат модели:** `.safetensors`.

---

## Технологический стек

* **Framework:** PyTorch
* **Feature Extractor:** EfficientNet-B0 (Pre-trained)
* **Temporal Model:** 2-layer GRU (Hidden size: 256)
* **Video Processing:** Decord, OpenCV
* **Model Storage:** Safetensors

---

## Анализ работы модели и освещения (Lighting Bias)

В ходе тестов было замечено, что модель, несмотря на высокую общую точность, сохраняет чувствительность к условиям освещенности:

* **Темные сцены:** Чаще классифицируются как **Violence**. Это обусловлено тем, что в обучающей выборке (записи с камер ночного видения, темных переулков) превалируют негативные сценарии.
* **Светлые сцены:** Имеют тенденцию классифицироваться как **Safe**, так как большинство "мирных" видео в датасете сняты при хорошем дневном свете.
* **Вывод:** Модель корректно ловит динамику драки, но свет является "подсказкой", которая может приводить к ложноположительным результатам в темноте.

---

## Структура проекта

* `cnn_gru.ipynb` — обновленный ноутбук с архитектурой CNN+GRU.
* `model_acc_1.0.86.safetensors` — финальные веса модели.
* `requirements.txt` — зависимости.

---

## Инструкция по запуску

### 1. Установка

```bash
pip install torch torchvision decord safetensors opencv-python tqdm

```

### 2. Тестирование (Inference)

В ноутбуке `cnn_gru.ipynb` реализован цикл проверки на реальных видео. Для инференса видео разбивается на 16 кадров, которые проходят через EfficientNet, а затем последовательность признаков анализируется GRU.

### 3. Тестовые видео из интернета

Модель успешно прошла проверку на следующих материалах:

1. [https://www.youtube.com/watch?v=tQp2EgxGmeo](https://www.youtube.com/watch?v=tQp2EgxGmeo)
2. [https://youtu.be/6949uuxkG6Y](https://www.google.com/search?q=https://youtu.be/6949uuxkG6Y)
3. [https://youtu.be/6AR0Uj-prHQ](https://www.google.com/search?q=https://youtu.be/6AR0Uj-prHQ)
4. [https://youtu.be/Pex0-KUbnxA](https://www.google.com/search?q=https://youtu.be/Pex0-KUbnxA)
5. [https://youtu.be/E1ulV2cGrwA](https://www.google.com/search?q=https://youtu.be/E1ulV2cGrwA)


## Описание моделей
В проекте доступны два варианта весов:

### model_acc_1.0.86.safetensors (Традиционная модель)

Архитектура: EfficientNet-B0 (CNN) + GRU.

Принцип: CNN извлекает пространственные признаки из каждого кадра, а двуслойная рекуррентная сеть (GRU) анализирует их последовательность во времени.

Результат: Показывает более высокую стабильность на данном датасете.

### violence_model_r2plus1d.safetensors (Fine-tuned модель)

Архитектура: R(2+1)D.

Принцип: Глубокое обучение на базе 3D-сверток, где временные и пространственные признаки вычисляются одновременно.

Результат: Хорошо ловит сложные динамические паттерны движений.
